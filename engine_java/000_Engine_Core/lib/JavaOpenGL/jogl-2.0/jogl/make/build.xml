
<project name="JOGL_ALL" basedir="." default="all">

    <import file="versions.xml" />

  <!-- Pull in GlueGen cpptasks build file to pick up os.and.arch -->
  <property name="gluegen.root" value="../../gluegen" />
  <import file="${gluegen.root}/make/gluegen-cpptasks.xml" />

    <target name="init">
        <property name="project.root" value=".." />
        <condition property="rootrel.build" value="build">
          <not>
              <isset property="rootrel.build"/>
          </not>
        </condition>
        <property name="build" value="${project.root}/${rootrel.build}" />
        <property name="src" value="${project.root}/src" />

        <property name="nativewindow.make.dir" value="." />
        <property name="nativewindow.build.xml" value="${nativewindow.make.dir}/build-nativewindow.xml" />
        <property name="jogl.make.dir" value="." />
        <property name="jogl.build.xml" value="${jogl.make.dir}/build-jogl.xml" />
        <property name="newt.make.dir" value="." />
        <property name="newt.build.xml" value="${newt.make.dir}/build-newt.xml" />

        <property name="all.srcj.path" value="${src}/nativewindow/classes;${src}/jogl/classes;${src}/newt/classes" />
        <!-- No generated classes for Newt at the present time -->
        <property name="all.genj.path" value="${build}/nativewindow/gensrc/classes;${build}/jogl/gensrc/classes" />

        <!-- The javadoc dirs. -->
        <property name="javadoc" value="${project.root}/javadoc_public" />
        <property name="javadoc.link" value="http://java.sun.com/j2se/1.4.2/docs/api/" />
        <property name="javadoc.overview" value="doc/jogl/spec-overview.html" />

        <property name="javadoc.nw.overview" value="../src/nativewindow/classes/javax/media/nativewindow/package.html" />
        <property name="javadoc.nw.spec" value="${project.root}/javadoc_nativewindow_spec" />
        <property name="javadoc.nw.spec.windowtitle" value="NativeWindow API -- ${nativewindow_base_version} Specification" />
        <property name="javadoc.nw.spec.packagenames" value="javax.media.nativewindow.*" />

        <property name="javadoc.spec" value="${project.root}/javadoc_jogl_spec" />
        <property name="javadoc.spec.windowtitle" value="JOGL API -- JSR-231 ${jogl_base_version} Specification" />
        <property name="javadoc.spec.packagenames" value="javax.media.opengl.*" />

        <property name="javadoc.windowtitle" value="JOGL, NativeWindow and NEWT APIs" />
        <property name="javadoc.packagenames" value="${javadoc.nw.spec.packagenames},${javadoc.spec.packagenames},com.sun.opengl.util.*,com.sun.javafx.newt, com.sun.javafx.newt.opengl" />

        <property name="javadoc.dev" value="${project.root}/javadoc_dev" />
        <property name="javadoc.dev.packagenames" value="${javadoc.packagenames},com.sun.opengl.impl.*,com.sun.nativewindow.impl.*,com.sun.javafx.newt.*,com.sun.gluegen,com.sun.gluegen.runtime" />

        <property name="java.excludes.javadoc.packagenames" value="com.sun.opengl.impl.gl2.fixme.*,com.sun.javafx.audio.windows.waveout.TestSpatialization"/>
        <property name="javadoc.bottom" value="Copyright 2005 Sun Microsystems, Inc. All rights reserved. Use is subject to &lt;a href=&quot;http://jcp.org/en/jsr/detail?id=231&quot;&gt;license terms&lt;/a&gt;." />

        <property name="gluegen.jar" value="../../gluegen/${rootrel.build}/gluegen.jar" />
        <property name="gluegen-rt.jar" value="../../gluegen/${rootrel.build}/gluegen-rt.jar" />
        <property name="nativewindow.all.jar" value="../${rootrel.build}/nativewindow/nativewindow.all.jar" />
        <property name="jogl.all.jar" value="../${rootrel.build}/jogl/jogl.all.jar" />
        <property name="newt.all.jar" value="../${rootrel.build}/newt/newt.all.jar" />

        <path id="all.classpath">
            <pathelement location="${nativewindow.all.jar}" />
            <pathelement location="${gluegen-rt.jar}" />
            <pathelement location="${jogl.all.jar}" />
            <pathelement location="${newt.all.jar}" />
        </path>

    </target>

    <target name="build.nativewindow" depends="init">
        <ant antfile="${nativewindow.build.xml}" dir="${nativewindow.make.dir}" target="all" inheritAll="false"/>
    </target>

    <target name="build.jogl" depends="init">
        <ant antfile="${jogl.build.xml}" dir="${jogl.make.dir}" target="all" inheritAll="false"/>
    </target>

    <target name="build.newt" depends="init">
        <ant antfile="${newt.build.xml}" dir="${newt.make.dir}" target="all" inheritAll="false"/>
    </target>

    <target name="one-lib-dir" depends="init,gluegen.cpptasks.detect.os">
        <property name="lib.dir" value="${build}/lib" />
        <delete includeEmptyDirs="true" quiet="true" dir="${lib.dir}" failonerror="false" />
        <mkdir dir="${lib.dir}" />
        <copy todir="${lib.dir}">
            <fileset dir="${project.root}/../gluegen/${rootrel.build}/obj" includes="*.${native.library.suffix} *.${native.library.suffix-cdc}" />
            <fileset dir="${build}/jogl/obj" includes="*.${native.library.suffix} *.${native.library.suffix-cdc}" />
            <fileset dir="${build}/nativewindow/obj" includes="*.${native.library.suffix} *.${native.library.suffix-cdc}" />
            <fileset dir="${build}/newt/obj" includes="*.${native.library.suffix} *.${native.library.suffix-cdc}" />
        </copy>
    </target>

    <!-- ================================================================== -->
    <!--
       - Build the per-platform binary zip archive for developers.
       - This must be called after all of the build targets complete.
      -->

    <target name="setup-version-RI" if="jogl.ri">
        <property name="tmp.version" value="${jogl_base_version}" />
    </target>

    <target name="setup-version-non-RI" unless="jogl.ri">
        <tstamp>
             <format property="timestamp" pattern="yyyyMMdd"/>
        </tstamp>
        <property name="tmp.version" value="${jogl_base_version}-pre-${timestamp}" />
    </target>

    <target name="developer-zip-archive" depends="gluegen.cpptasks.detect.os,setup-version-RI,setup-version-non-RI" unless="build.noarchives">
        <property name="archive.name" value="jogl-${tmp.version}-${os.and.arch}" />
        <property name="archive.dir" value="${build}/${archive.name}" />
        <delete includeEmptyDirs="true" quiet="true" dir="${archive.dir}" failonerror="false" />
        <mkdir dir="${archive.dir}" />
        <!-- Copy the appropriate pieces into the archive directory -->
        <copy file="../CHANGELOG.txt"  todir="${archive.dir}" />
        <copy file="../COPYRIGHT.txt"  todir="${archive.dir}" />
        <copy file="../LICENSE.txt"    todir="${archive.dir}" />
        <copy file="../doc/userguide/index.html" tofile="${archive.dir}/Userguide.html" />
        <copy file="README-zip-bundles.txt"
            tofile="${archive.dir}/README.txt"
            overwrite="true">
            <filterset>
                <filter token="VERSION" value="${tmp.version}"/>
            </filterset>
        </copy>
        <mkdir dir="${archive.dir}/lib" />
        <copy todir="${archive.dir}/lib">
            <fileset dir="${project.root}/../gluegen/${rootrel.build}" includes="gluegen-rt.jar gluegen-rt-cdc.jar" />
            <fileset dir="${project.root}/../gluegen/${rootrel.build}/obj" includes="*.${native.library.suffix} *.${native.library.suffix-cdc}" />
            <fileset dir="${build}/jogl" includes="*.jar" excludes="*natives*.jar" />
            <fileset dir="${build}/jogl/obj" includes="*.${native.library.suffix} *.${native.library.suffix-cdc}" />
            <fileset dir="${build}/nativewindow" includes="*.jar" excludes="*natives*.jar" />
            <fileset dir="${build}/nativewindow/obj" includes="*.${native.library.suffix} *.${native.library.suffix-cdc}" />
            <fileset dir="${build}/newt" includes="*.jar" excludes="*natives*.jar" />
            <fileset dir="${build}/newt/obj" includes="*.${native.library.suffix} *.${native.library.suffix-cdc}" />
        </copy>
        <mkdir dir="${archive.dir}/etc" />
        <copy todir="${archive.dir}/etc">
            <fileset dir="${project.root}/etc" includes="*" />
        </copy>
        <delete quiet="true" file="${build}/${archive.name}.zip"/>
        <zip destfile="${build}/${archive.name}.zip"
             basedir="${build}"
             includes="${archive.name}/**" />
        <!-- Clean up after ourselves -->
        <delete includeEmptyDirs="true" quiet="true" dir="${archive.dir}" failonerror="false" />
    </target>

    <!-- ================================================================== -->
    <!--
       - Build the source archive for developers.
       - This must be called after all of the build targets complete.
      -->

    <target name="source-archive" depends="setup-version-RI,setup-version-non-RI" unless="build.noarchives">
        <!-- NOTE that if you are using multiple rootrel.build directories within the same
             repository, the exclude lists here won't work well enough and you will wind up
             archiving binary bits from other rootrel.build settings in the source archive.
             This is inevitable given that we don't want to specialize this target to
             explicitly include top level files and directories, to make it future-proof. -->
        <delete quiet="true" file="${build}/jogl-${tmp.version}-src.zip"/>
        <zip destfile="${build}/jogl-${tmp.version}-src.zip"
             basedir="${project.root}/.."
             excludes="gluegen/${rootrel.build}/**,gluegen/build/**gluegen/build-temp/**,jogl/${rootrel.build}/**,jogl/build/**,jogl/build-temp/**,jogl/www/**"
             includes="gluegen/**, jogl/**" />
        <!-- Now add in certain portions of the generated source code for developers -->
        <zip update="true"
             destfile="${build}/jogl-${tmp.version}-src.zip"
             basedir="${project.root}/.."
             includes="jogl/${rootrel.build}/jogl/gensrc/classes/javax/media/opengl/**" />
    </target>

    <!-- ================================================================== -->
    <!--
       - Main build target.
      -->

    <target name="all" description="Build nativewindow, jogl and newt projects" depends="init,build.nativewindow,build.jogl,build.newt,one-lib-dir,developer-zip-archive,source-archive" />

    <target name="clean" depends="init">
        <ant antfile="${nativewindow.build.xml}" dir="${nativewindow.make.dir}" target="clean" inheritAll="false"/>
        <ant antfile="${jogl.build.xml}" dir="${jogl.make.dir}" target="clean" inheritAll="false"/>
        <ant antfile="${newt.build.xml}" dir="${newt.make.dir}" target="clean" inheritAll="false"/>
        <delete includeEmptyDirs="true" quiet="true">
            <fileset dir="${build}" />
        </delete>
    </target>        

    <target name="javadoc" depends="init">
        <!-- Build the general public Javadoc -->
        <javadoc packagenames="${javadoc.packagenames}"
                 excludepackagenames="${java.excludes.javadoc.packagenames}"
                 sourcepath="${all.srcj.path};${all.genj.path}"
                 destdir="${javadoc}" windowtitle="${javadoc.windowtitle}"
                 overview="${javadoc.overview}" 
                 source="1.4"
         bottom="${javadoc.bottom}" >
         <classpath refid="all.classpath"/>
         <link offline="true" href="${javadoc.link}" packagelistLoc="142-packages" />
          <taglet name="net.highteq.nativetaglet.NativeTaglet" path="${gluegen.jar}" />
        </javadoc>
    </target>

    <target name="javadoc.jogl.spec" depends="init,javadoc.nw.spec">
        <!-- Build the specification Javadoc -->
        <javadoc packagenames="${javadoc.spec.packagenames}"
                 excludepackagenames="${java.excludes.javadoc.packagenames}"
                 sourcepath="${all.srcj.path};${all.genj.path}"
                 destdir="${javadoc.spec}" windowtitle="${javadoc.spec.windowtitle}"
                 overview="${javadoc.overview}"
                 source="1.4"
                 bottom="${javadoc.bottom}" >
         <classpath refid="all.classpath"/>
         <link offline="true" href="${javadoc.link}" packagelistLoc="142-packages" />
         <link offline="false" href="${javadoc.nw.spec}" />
          <taglet name="net.highteq.nativetaglet.NativeTaglet" path="${gluegen.jar}" />
        </javadoc>
    </target>
                                                                                                                                   
    <target name="javadoc.dev" depends="init">
        <!-- Build the internal developer Javadoc -->
        <javadoc packagenames="${javadoc.dev.packagenames}"
                 excludepackagenames="${java.excludes.javadoc.packagenames}"
                 sourcepath="${all.srcj.path};${all.genj.path}"
                 destdir="${javadoc.dev}" windowtitle="${javadoc.windowtitle}"
                 overview="${javadoc.overview}" 
                 source="1.4"
         bottom="${javadoc.bottom}" >
         <classpath refid="all.classpath"/>
         <link offline="true" href="${javadoc.link}" packagelistLoc="142-packages" />
          <taglet name="net.highteq.nativetaglet.NativeTaglet" path="${gluegen.jar}" />
        </javadoc>
    </target>

    <target name="javadoc.nw.spec" depends="init">
        <!-- Build the general Javadoc -->
        <javadoc packagenames="${javadoc.nw.spec.packagenames}"
                 excludepackagenames="${java.excludes.javadoc.packagenames}"
                 sourcepath="${all.srcj.path};${all.genj.path}"
                 destdir="${javadoc.nw.spec}" windowtitle="${javadoc.nw.spec.windowtitle}"
                 overview="${javadoc.nw.overview}"
                 source="1.4"
                 bottom="${javadoc.bottom}" >
         <classpath refid="all.classpath"/>
         <link offline="true" href="${javadoc.link}" packagelistLoc="142-packages" />
         <taglet name="net.highteq.nativetaglet.NativeTaglet" path="${gluegen.jar}" />
        </javadoc>
    </target>
                                                                                                                                   
    <target name="javadoc.spec" description="Build Specifications JOGL and Nativewindow" depends="init,javadoc.jogl.spec" />

    <target name="all.doc" description="Build NativeWindow, JOGL and NEWT docs" depends="init,javadoc,javadoc.spec,javadoc.dev" />

</project>

