<?xml version="1.0" encoding="utf-8"?>
<mx:WindowedApplication xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:local="*" 
	layout="absolute" width="800" height="600"
	title="Contact Manager"
	creationComplete="initApp()">

	<mx:Script>
		<![CDATA[

			import mx.collections.ArrayCollection;
		
			[Bindable]
			private var contacts:ArrayCollection;
			
			private var em:EntityManager = EntityManager.getInstance();
			
			private function initApp():void
			{
				var dbFile:File = File.userDirectory.resolvePath("max999.db");  
				var newDB:Boolean = !dbFile.exists;
				var sqlConnection:SQLConnection = new SQLConnection(true); 
				sqlConnection.open(dbFile);

				em.sqlConnection = sqlConnection;

				if (newDB)
				{
					var contact:Contact = new Contact();
					contact.firstName = "Christophe";
					contact.lastName = "Coenraets";
					contact.email = "ccoenrae@adobe.com";
					em.save(contact);
					contact = new Contact();
					contact.firstName = "John";
					contact.lastName = "Smith";
					contact.email = "jsmith@adobe.com";
					em.save(contact);
				}
				loadContacts();
			}
			
			private function loadContacts():void 
			{
				contacts = em.findAll(Contact);
			}
			
		]]>
	</mx:Script>

	<mx:ApplicationControlBar width="100%" cornerRadius="0">
		<mx:Button label="Refresh" click="loadContacts()"/>	
		<mx:Button label="New" click="form.newItem()"/>	
		<mx:Button label="Save" click="form.saveItem()"/>	
		<mx:Button label="Delete" click="form.deleteItem()"/>	
	</mx:ApplicationControlBar>

	<mx:HBox width="100%" height="100%" top="40" left="8" right="8" bottom="8">
		<mx:DataGrid id="dg" dataProvider="{contacts}" width="100%" height="100%"/>
		<local:ContactForm id="form" contact="{dg.selectedItem as Contact}"/>
	</mx:HBox>

</mx:WindowedApplication>